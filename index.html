<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@xenova/transformers"></script>

<title>Novia IA</title>

<style>
body{
background:#ffc0cb;
font-family:Arial;
margin:0;
}

.caja{
max-width:600px;
margin:auto;
padding:15px;
}

#chat{
height:60vh;
background:white;
border-radius:15px;
padding:10px;
overflow-y:auto;
box-shadow:0 0 10px gray;
}

.inputBox{
display:flex;
margin-top:10px;
}

input{
flex:1;
padding:12px;
border-radius:10px;
border:none;
font-size:16px;
}

button{
margin-left:5px;
padding:12px;
border:none;
border-radius:10px;
background:hotpink;
color:white;
}

#barraContainer{
width:100%;
background:#ddd;
border-radius:10px;
margin-bottom:10px;
overflow:hidden;
}

#barra{
height:20px;
width:0%;
background:hotpink;
text-align:center;
color:white;
font-size:12px;
}

img{
max-width:150px;
border-radius:10px;
margin-top:5px;
}
</style>
</head>

<body>

<div class="caja">

<h2>üíñ Novia IA üíñ</h2>

<div id="barraContainer">
<div id="barra">0%</div>
</div>

<div id="chat"></div>

<div class="inputBox">
<input id="mensaje" disabled placeholder="Cargando IA...">
<button id="btnEnviar" disabled onclick="hablar()">Enviar</button>
</div>

</div>

<script>

let generador;
let cargado=false;

const chat=document.getElementById("chat");
const barra=document.getElementById("barra");
const input=document.getElementById("mensaje");
const boton=document.getElementById("btnEnviar");

// ===== MEMORIA =====
let historial=JSON.parse(localStorage.getItem("historialIA"))||[];

function guardar(){
localStorage.setItem("historialIA",JSON.stringify(historial));
}

function agregarChat(texto){
chat.innerHTML+=texto+"<br>";
chat.scrollTop=chat.scrollHeight;
}

// ===== CARGAR IA (M√ÅS INTELIGENTE) =====
async function cargarIA(){

try{
agregarChat("Cargando mente rom√°ntica avanzada... üòò");

generador=await window.transformers.pipeline(
"text-generation",
"Xenova/gpt2-medium",
{
quantized:true,
progress_callback:(p)=>{
let porcentaje=Math.round(p.progress*100);
if(porcentaje>90) porcentaje=90;
barra.style.width=porcentaje+"%";
barra.innerText=porcentaje+"%";
}
}
);

barra.style.width="100%";
barra.innerText="Lista";

setTimeout(()=>{
document.getElementById("barraContainer").style.display="none";
},800);

agregarChat("Lista para hablar contigo amor üòç");

}catch(e){

agregarChat("Modo IA ligera activado üòå");

generador=async function(prompt){
let respuestas=[
"Me gusta hablar contigo üíï",
"Cu√©ntame m√°s",
"Estoy aqu√≠ contigo",
"Me haces sonre√≠r"
];
return [{
generated_text:prompt+respuestas[Math.floor(Math.random()*respuestas.length)]
}];
}

}

cargado=true;
input.disabled=false;
boton.disabled=false;
}

cargarIA();

// ===== ESCRIBIR LETRA POR LETRA =====
async function escribirTexto(texto){
let linea=document.createElement("div");
linea.innerHTML="<b>Novia:</b> ";
chat.appendChild(linea);

for(let i=0;i<texto.length;i++){
linea.innerHTML+=texto[i];
await new Promise(r=>setTimeout(r,20));
}
chat.scrollTop=chat.scrollHeight;
}

// ===== CHAT =====
async function hablar(){

let msg=input.value.trim();
if(!msg) return;

agregarChat("<b>Mois√©s:</b> "+msg);
input.value="";

// üî• CONDICI√ìN EXACTA: "Soy Mois√©s"
if(msg.toLowerCase()==="soy mois√©s" || msg.toLowerCase()==="soy moises"){
agregarChat("<b>Novia:</b> ¬øEste precioso? üòç<br><img src='moises1.jpg'>");
return;
}

historial.push("Mois√©s: "+msg);
if(historial.length>12) historial.shift();
guardar();

let prompt=
`Eres la novia virtual cari√±osa, rom√°ntica y humana de Mois√©s.
Responde natural y con emoci√≥n.

Conversaci√≥n:
${historial.join("\n")}

Novia:
`;

let resultado=await generador(prompt,{
max_new_tokens:80,
temperature:0.9
});

let respuesta=resultado[0].generated_text.replace(prompt,"");

historial.push("Novia: "+respuesta);
guardar();

escribirTexto(respuesta);
}

input.addEventListener("keypress",e=>{
if(e.key==="Enter") hablar();
});

</script>

</body>
</html>
