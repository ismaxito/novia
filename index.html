                              <!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@xenova/transformers"></script>

<title>Novia IA</title>

<style>
body{
background:#ffc0cb;
font-family:Arial;
margin:0;
}

.caja{
max-width:600px;
margin:auto;
padding:15px;
}

#chat{
height:60vh;
background:white;
border-radius:15px;
padding:10px;
overflow-y:auto;
box-shadow:0 0 10px gray;
}

.inputBox{
display:flex;
margin-top:10px;
}

input{
flex:1;
padding:12px;
border-radius:10px;
border:none;
font-size:16px;
}

button{
margin-left:5px;
padding:12px;
border:none;
border-radius:10px;
background:hotpink;
color:white;
}

#barraContainer{
width:100%;
background:#ddd;
border-radius:10px;
margin-bottom:10px;
overflow:hidden;
}

#barra{
height:20px;
width:0%;
background:hotpink;
text-align:center;
color:white;
font-size:12px;
}
</style>
</head>

<body>

<div class="caja">

<h2>üíñ Novia IA üíñ</h2>

<div id="barraContainer">
<div id="barra">0%</div>
</div>

<div id="chat"></div>

<div class="inputBox">
<input id="mensaje" disabled placeholder="Cargando IA...">
<button onclick="hablar()" id="btnEnviar" disabled>Enviar</button>
</div>

</div>

<script>

let generador;
let cargado=false;

const chat = document.getElementById("chat");
const barra = document.getElementById("barra");
const input = document.getElementById("mensaje");
const boton = document.getElementById("btnEnviar");

// ===== MEMORIA CHATGPT STYLE =====
let historial = JSON.parse(localStorage.getItem("historialIA")) || [];

function guardar(){
localStorage.setItem("historialIA", JSON.stringify(historial));
}

function agregarChat(texto){
chat.innerHTML += texto + "<br>";
chat.scrollTop = chat.scrollHeight;
}

// ===== BARRA REAL =====
async function cargarIA(){

try{

let progreso = 0;
let fake = setInterval(()=>{
if(progreso < 90){
progreso++;
barra.style.width = progreso+"%";
barra.innerText = progreso+"%";
}
},200);

generador = await window.transformers.pipeline(
"text-generation",
"Xenova/distilgpt2",
{quantized:true}
);

clearInterval(fake);
barra.style.width="100%";
barra.innerText="100%";

agregarChat("Lista para hablar contigo amor üòò");

}catch(e){

agregarChat("Modo b√°sico activado üòå");

generador = async function(prompt){
let r = [
"Me gusta hablar contigo üíï",
"Cu√©ntame m√°s",
"Estoy aqu√≠ contigo",
"Eso suena interesante",
"Me haces sonre√≠r"
];

return [{
generated_text: prompt + r[Math.floor(Math.random()*r.length)]
}];
}

}

cargado=true;
input.disabled=false;
boton.disabled=false;
}

cargarIA();

// ===== ESCRITURA PROGRESIVA (COMO CHATGPT) =====
async function escribirTexto(texto){

let linea = document.createElement("div");
linea.innerHTML="<b>Novia:</b> ";
chat.appendChild(linea);

for(let i=0;i<texto.length;i++){
linea.innerHTML += texto[i];
await new Promise(r => setTimeout(r,25));
}

chat.scrollTop = chat.scrollHeight;
}

// ===== CHAT =====
async function hablar(){

let msg = input.value.trim();
if(!msg) return;

agregarChat("<b>Mois√©s:</b> "+msg);
input.value="";

// FOTO ESPECIAL
if(msg.toLowerCase().includes("hola soy moises")){
agregarChat("<b>Novia:</b> ¬øEste precioso? üòç<br><img src='moises.jpg' width='150'>");
return;
}

// guardar historial
historial.push("Mois√©s: "+msg);
if(historial.length>10) historial.shift();
guardar();

let prompt = `
Eres la novia virtual cari√±osa, divertida y rom√°ntica de Mois√©s.
Habla natural, humana, emocional.

Conversaci√≥n:
${historial.join("\n")}

Novia:
`;

let resultado = await generador(prompt,{
max_new_tokens:60,
temperature:0.9
});

let respuesta = resultado[0].generated_text.replace(prompt,"");

historial.push("Novia: "+respuesta);
guardar();

escribirTexto(respuesta);
}

input.addEventListener("keypress", e=>{
if(e.key==="Enter") hablar();
});

</script>

</body>
</html>
