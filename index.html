<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@xenova/transformers"></script>

<title>Novia IA</title>

<style>
body{
background:#ffc0cb;
font-family:Arial;
margin:0;
}

.caja{
max-width:600px;
margin:auto;
padding:15px;
}

#chat{
height:60vh;
background:white;
border-radius:15px;
padding:10px;
overflow-y:auto;
box-shadow:0 0 10px gray;
}

.inputBox{
display:flex;
margin-top:10px;
}

input{
flex:1;
padding:12px;
border-radius:10px;
border:none;
font-size:16px;
}

button{
margin-left:5px;
padding:12px;
border:none;
border-radius:10px;
background:hotpink;
color:white;
}

#barraContainer{
width:100%;
background:#ddd;
border-radius:10px;
margin-bottom:10px;
overflow:hidden;
}

#barra{
height:20px;
width:0%;
background:hotpink;
text-align:center;
color:white;
font-size:12px;
}

img{
max-width:150px;
border-radius:10px;
margin-top:5px;
}
</style>
</head>

<body>

<div class="caja">
<h2>üíñ Novia IA üíñ</h2>

<div id="barraContainer">
<div id="barra">0%</div>
</div>

<div id="chat"></div>

<div class="inputBox">
<input id="mensaje" disabled placeholder="Cargando IA real...">
<button id="btnEnviar" disabled onclick="hablar()">Enviar</button>
</div>
</div>

<script>

let generador = null;
let modoReal = false;

const chat = document.getElementById("chat");
const barra = document.getElementById("barra");
const input = document.getElementById("mensaje");
const boton = document.getElementById("btnEnviar");

function agregarChat(t){
chat.innerHTML += t + "<br>";
chat.scrollTop = chat.scrollHeight;
}

// ===== CARGAR IA REAL =====
async function cargarIA(){

agregarChat("Descargando IA real (esto tarda la primera vez)... üòò");

try{

generador = await window.transformers.pipeline(
"text-generation",
"Xenova/distilgpt2",
{
quantized: true,
progress_callback: (p)=>{
let pct = Math.round(p.progress * 100);
barra.style.width = pct + "%";
barra.innerText = pct + "%";
}
}
);

modoReal = true;
barra.style.width = "100%";
barra.innerText = "Lista";

setTimeout(()=>{
document.getElementById("barraContainer").style.display="none";
},700);

agregarChat("IA real activada üíñ");

}catch(e){

agregarChat("‚ö†Ô∏è IA pesada fall√≥, usando modo b√°sico");

}

input.disabled = false;
boton.disabled = false;
}

cargarIA();

// ===== ESCRIBIR LETRA POR LETRA =====
async function escribir(texto){
let d = document.createElement("div");
d.innerHTML = "<b>Novia:</b> ";
chat.appendChild(d);

for(let c of texto){
d.innerHTML += c;
await new Promise(r=>setTimeout(r,25));
}
}

// ===== CHAT =====
async function hablar(){

let msg = input.value.trim();
if(!msg) return;

agregarChat("<b>Mois√©s:</b> " + msg);
input.value = "";

// FOTO
if(msg.toLowerCase()==="soy mois√©s" || msg.toLowerCase()==="soy moises"){
agregarChat("<b>Novia:</b> ¬øEste precioso? üòç<br><img src='moises1.jpg'>");
return;
}

// RESPUESTA
if(modoReal){

let r = await generador(
`Eres la novia cari√±osa de Mois√©s.
Conversaci√≥n:
Mois√©s: ${msg}
Novia:`,
{ max_new_tokens: 60, temperature: 0.9 }
);

let texto = r[0].generated_text.split("Novia:")[1];
escribir(texto);

}else{

let basico = [
"Me gusta hablar contigo üíï",
"Cu√©ntame m√°s bb",
"Estoy aqu√≠ contigo üòå",
"Eso suena interesante JSJS"
];

escribir(basico[Math.floor(Math.random()*basico.length)]);
}

}

input.addEventListener("keypress",e=>{
if(e.key==="Enter") hablar();
});

</script>
</body>
</html>
